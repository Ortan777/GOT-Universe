{% extends 'base.html' %}

{% block content %}

<h2 class="text-4xl font-bold text-red-400 mb-10">
    Timeline of Westeros
</h2>

<form method="get" class="mb-10">
    <select name="season" onchange="this.form.submit()" 
        class="bg-gray-800 text-white p-2 rounded">
        <option value="">All Seasons</option>
        {% for s in seasons %}
            <option value="{{ s }}" {% if selected_season == s|stringformat:"s" %}selected{% endif %}>
                Season {{ s }}
            </option>
        {% endfor %}
    </select>
</form>

<div class="relative border-l-4 border-red-500 ml-6">

    {% for event in events %}
        <div class="mb-12 ml-6 timeline-item opacity-0 translate-y-6 transition-all duration-700">

            <div class="absolute -left-3 w-6 h-6 bg-red-500 rounded-full border-4 border-gray-900"></div>

            <div class="bg-gray-800 p-6 rounded-lg shadow-lg hover:shadow-red-500/30 transition">

                <h3 class="text-2xl font-semibold text-yellow-400">
                    {{ event.title }}
                </h3>

                <p class="text-gray-400 text-sm">
                    Season {{ event.season }} | Episode {{ event.episode }}
                </p>

                <p class="mt-3">
                    {{ event.description }}
                </p>

                <p class="mt-3 text-blue-400">
                    Location: {{ event.location }}
                </p>

            </div>
        </div>
    {% empty %}
        <p>No events found.</p>
    {% endfor %}

</div>

<script>
    // Scroll animation
    const items = document.querySelectorAll('.timeline-item');

    const reveal = () => {
        const triggerBottom = window.innerHeight * 0.85;

        items.forEach(item => {
            const boxTop = item.getBoundingClientRect().top;

            if (boxTop < triggerBottom) {
                item.classList.remove('opacity-0', 'translate-y-6');
            }
        });
    };

    window.addEventListener('scroll', reveal);
    reveal();
</script>

{% endblock %}
