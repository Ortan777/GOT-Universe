{% extends 'base.html' %}

{% block content %}

<h2 class="text-3xl font-bold text-yellow-400 mb-6">
    Character Relationship Graph
</h2>

<form method="get" class="mb-6">
    <select name="season" onchange="this.form.submit()" 
        class="bg-gray-800 text-white p-2 rounded">
        <option value="">All Seasons</option>
        {% for s in seasons %}
            {% if s %}
                <option value="{{ s }}" {% if selected_season == s|stringformat:"s" %}selected{% endif %}>
                    Season {{ s }}
                </option>
            {% endif %}
        {% endfor %}
    </select>
</form>


<div id="cy" class="h-[700px] bg-gray-800 rounded-lg"></div>

<script src="https://unpkg.com/cytoscape/dist/cytoscape.min.js"></script>


<script>
    var graphData = {{ graph_data|safe }};

    var cy = cytoscape({
        container: document.getElementById('cy'),

        elements: [
            ...graphData.nodes,
            ...graphData.edges
        ],

        style: [
            {
                selector: 'node',
                style: {
                    'background-color': '#facc15',
                    'label': 'data(label)',
                    'color': '#000',
                    'text-valign': 'center',
                    'text-halign': 'center'
                }
            },
            {
                selector: 'edge',
                style: {
                    'width': 2,
                    'line-color': '#ef4444',
                    'target-arrow-color': '#ef4444',
                    'target-arrow-shape': 'triangle',
                    'curve-style': 'bezier',
                    'label': 'data(label)',
                    'font-size': '10px',
                    'color': '#fff'
                }
            }
        ],

        layout: {
            name: 'cose'
        }
    });

    // Click node â†’ go to character page
    cy.on('tap', 'node', function(evt){
        var id = evt.target.id();
        window.location.href = "/characters/" + id + "/";
    });

</script>

{% endblock %}
